{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2>Adicionar Nova Meta de Economia</h2>
    <form action="{{ url_for('main.saving_goal') }}" method="POST">
        <div class="mb-3">
            <label for="goal_name" class="form-label">Nome da Meta</label>
            <input type="text" class="form-control" id="goal_name" name="goal_name" placeholder="Ex: Viagem para Europa" required>
        </div>

        <div class="mb-3">
            <label for="target_amount" class="form-label">Valor Alvo (R$)</label>
            <input type="number" class="form-control" id="target_amount" name="target_amount" placeholder="Ex: 25000" step="0.01" required>
        </div>

        <div class="mb-3">
            <label for="target_date" class="form-label">Data Alvo</label>
            <input type="date" class="form-control" id="target_date" name="target_date" required>
        </div>

        <button type="submit" class="btn btn-primary">Salvar Meta</button>
    </form>

    <hr class="my-5">
    <h2 class="mb-4">üéØ Metas Ativas</h2>
    <div class="row">
        {% for goal in goals if not goal.completed %}
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ goal.goal_name }}</h5>
                    <p class="mb-1"><strong>Data:</strong> {{ goal.target_date.strftime('%d/%m/%Y') }}</p>
                    <p class="mb-1"><strong>Valor Alvo:</strong> R$ {{ goal.target_amount | brl }}</p>
                    <p class="mb-2"><strong>Falta:</strong> R$ {{ (goal.target_amount - goal.current_amount) | brl }}</p>

                    {% set percent = (goal.current_amount / goal.target_amount) * 100 %}
                    <div class="progress mb-3">
                        <div class="progress-bar {% if percent >= 100 %}bg-success{% else %}bg-info{% endif %}"
                             style="width: {{ percent if percent <= 100 else 100 }}%">
                            {{ percent|round(1) }}%
                        </div>
                    </div>

                    <!-- Adicionar valor -->
                    <form method="POST" action="{{ url_for('main.add_to_goal', goal_id=goal.id) }}" class="d-flex mb-2">
                        <input type="number" name="amount" step="0.01" class="form-control me-2" placeholder="Adicionar valor" required>
                        <button class="btn btn-primary">+</button>
                    </form>

                    <!-- Concluir meta -->
                    <form method="POST" action="{{ url_for('main.complete_goal', goal_id=goal.id) }}" class="mb-2">
                        <button class="btn btn-outline-success w-100">‚úî Marcar como conclu√≠da</button>
                    </form>

                    <!-- Excluir meta -->
                    <form method="POST" action="{{ url_for('main.delete_goal', goal_id=goal.id) }}">
                        <button class="btn btn-outline-danger w-100">üóë Excluir Meta</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <hr class="my-5">
    <h2 class="mb-4">üèÜ Metas Conclu√≠das üöÄ</h2>
    <div class="row">
        {% for goal in goals if goal.completed %}
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm border-success">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ goal.goal_name }}
                        <span class="badge bg-success">Conclu√≠da</span>
                    </h5>
                    <p class="mb-1"><strong>Data:</strong> {{ goal.target_date.strftime('%d/%m/%Y') }}</p>
                    <p class="mb-1"><strong>Valor Alvo:</strong> R$ {{ "{:,.2f}".format(goal.target_amount) }}</p>
                    <p class="mb-2"><strong>Falta:</strong> R$ {{ "{:,.2f}".format(goal.target_amount - goal.current_amount) }}</p>

                    {% set percent = (goal.current_amount / goal.target_amount) * 100 %}
                    <div class="progress mb-3">
                        <div class="progress-bar bg-success" style="width: {{ percent if percent <= 100 else 100 }}%">
                            {{ percent|round(1) }}%
                        </div>
                    </div>

                    <!-- Excluir meta conclu√≠da -->
                    <form method="POST" action="{{ url_for('main.delete_goal', goal_id=goal.id) }}">
                        <button class="btn btn-outline-danger w-100">üóë Excluir Meta</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
