{% extends "base.html" %}

{% block content %}
<div class="container section">
    <h2>Calendário</h2>
    <div id="calendar-container">
        <div id="calendar"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- Carregando dependências -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',  // Botões para navegar no calendário
                    center: 'title',          // Título central (nome do mês)
                    right: 'month,agendaWeek,agendaDay'  // Opções de visualização
                },
                events: [
                    {% for revenue in revenues %}
                        {
                            title: "{{ revenue['description'][:10] }}...",  // Limita o título a 15 caracteres
                        },
                    {% endfor %}
                    {% for expense in expenses %}
                        {
                            title: " {{ expense['description'][:10] }}...",  // Limita o título a 15 caracteres
                            start: "{{ expense['expense_date'] }}T00:00:00",  // Data do evento
                            description: "{{ expense['description'] }}",  // Descrição completa
                            amount: "{{ expense['amount'] }}"  // Valor da transação
                        },
                    {% endfor %}
                ],
                eventRender: function(event, element) {
                    // Tooltip exibido ao passar o mouse sobre o evento
                    element.tooltip({
                        title: 'Descrição: ' + event.description + '<br>' + 
                               'Valor: ' + event.amount + '<br>' + 
                               'Conta: ' + event.account,
                        placement: 'top'
                    });
                },
                eventClick: function(event, jsEvent, view) {
                    // Exibe o resumo do evento ao clicar
                    alert('Data: ' + event.start.format('DD/MM/YYYY') + '\n' + 
                          'Tipo: ' + event.type + '\n' + 
                          'Descrição: ' + event.description + '\n' + 
                          'Categoria: ' + event.category);
                }
            });
        });
    </script>
{% endblock %}
